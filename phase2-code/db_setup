from pymongo import MongoClient
import json
from bson import ObjectId
from dotenv import load_dotenv
import os

# Before running this script
# ensure that MongoDB is installed on your device and activated
# and set up .env variables

load_dotenv()

# Access the environment variables
database_uri = os.getenv('DATABASE_URI')
db_name = os.getenv('DB_NAME')
collection_1 = os.getenv('DB_COLLECTION_1')
collection_2 = os.getenv('DB_COLLECTION_2')
collection_3 = os.getenv('DB_COLLECTION_3')
filename_1 = os.getenv('FILENAME_1')
filename_2 = os.getenv('FILENAME_2')
filename_3 = os.getenv('FILENAME_3')

# Connect to MongoDB (local instance by default)
client = MongoClient(database_uri)  # Default MongoDB URI

# Create or switch to your desired database
db = client[db_name]

# Create or switch to your desired collection
collection_1 = db[collection_1]
collection_2 = db[collection_2]
collection_3 = db[collection_3]

# Open and read the humans JSON file
with open(filename_1) as f:
    # Loop through each line in the file
    for line in f:
        # Parse the line as a JSON object
        data = json.loads(line.strip())
        if '_id' in data and isinstance(data['_id'], dict) and '$oid' in data['_id']:
            # Convert the $oid string to ObjectId
            data['_id'] = ObjectId(data['_id']['$oid'])
        
        # Insert the data into the collection
        collection_1.insert_one(data)

print(f"Data inserted successfully into {db_name} -> {collection_1}")

# Open and read the moderate bots JSON file
with open(filename_2) as f:
    # Loop through each line in the file
    for line in f:
        # Parse the line as a JSON object
        data = json.loads(line.strip())
        if '_id' in data and isinstance(data['_id'], dict) and '$oid' in data['_id']:
            # Convert the $oid string to ObjectId
            data['_id'] = ObjectId(data['_id']['$oid'])
        
        # Insert the data into the collection
        collection_2.insert_one(data)

print(f"Data inserted successfully into {db_name} -> {collection_2}")

# Open and read the advanced bots JSON file
with open(filename_3) as f:
    # Loop through each line in the file
    for line in f:
        # Parse the line as a JSON object
        data = json.loads(line.strip())
        if '_id' in data and isinstance(data['_id'], dict) and '$oid' in data['_id']:
            # Convert the $oid string to ObjectId
            data['_id'] = ObjectId(data['_id']['$oid'])
        
        # Insert the data into the collection
        collection_3.insert_one(data)

print(f"Data inserted successfully into {db_name} -> {collection_3}")
